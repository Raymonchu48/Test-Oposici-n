<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpoStudy - Tests Auxiliar Inform√°tico</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#4361ee">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #f72585;
            --success: #4cc9f0;
            --danger: #f72585;
            --dark: #1a1a2e;
            --dark-card: #16213e;
            --light: #edf2f4;
            --gray: #8d99ae;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--dark); color: var(--light); min-height: 100vh; overflow-x: hidden; }
        .app-container { max-width: 600px; margin: 0 auto; min-height: 100vh; padding-bottom: 80px; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, #7209b7 100%); padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(67, 97, 238, 0.3); }
        .header h1 { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .progress-bar { height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success); transition: width 0.3s ease; }
        .screen { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--dark-card); border-radius: 16px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card .number { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .stat-card .label { font-size: 0.85rem; color: var(--gray); margin-top: 5px; }
        .blocks-section h2 { font-size: 1.2rem; margin-bottom: 15px; color: var(--light); }
        .block-card { background: var(--dark-card); border-radius: 16px; padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent; }
        .block-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(67, 97, 238, 0.2); }
        .block-card.selected { border-color: var(--primary); background: linear-gradient(135deg, var(--dark-card) 0%, rgba(67, 97, 238, 0.1) 100%); }
        .block-card h3 { font-size: 1rem; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .block-card .badge { font-size: 0.75rem; background: var(--primary); padding: 4px 10px; border-radius: 20px; margin-left: auto; }
        .block-card p { font-size: 0.85rem; color: var(--gray); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; border-radius: 12px; font-weight: 600; font-size: 1rem; cursor: pointer; border: none; transition: all 0.3s ease; width: 100%; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, #7209b7 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--dark-card); color: var(--light); border: 1px solid rgba(255,255,255,0.1); }
        .question-counter { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .question-counter .current { font-size: 0.9rem; color: var(--gray); }
        .question-counter .timer { background: var(--dark-card); padding: 8px 16px; border-radius: 20px; font-weight: 600; color: var(--success); }
        .question-card { background: var(--dark-card); border-radius: 20px; padding: 25px; margin-bottom: 25px; }
        .question-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px; }
        .options-list { display: flex; flex-direction: column; gap: 12px; }
        .option { background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px 20px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; }
        .option:hover { border-color: var(--primary); background: rgba(67, 97, 238, 0.1); }
        .option.selected { border-color: var(--primary); background: rgba(67, 97, 238, 0.2); }
        .option.correct { border-color: #4cc9f0; background: rgba(76, 201, 240, 0.2); }
        .option.incorrect { border-color: var(--danger); background: rgba(247, 37, 133, 0.2); }
        .option .letter { width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0; }
        .option.selected .letter { background: var(--primary); }
        .option.correct .letter { background: #4cc9f0; }
        .option.incorrect .letter { background: var(--danger); }
        .result-card { text-align: center; padding: 40px 20px; }
        .result-score { font-size: 4rem; font-weight: 700; background: linear-gradient(135deg, var(--success) 0%, var(--primary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .result-label { font-size: 1.2rem; color: var(--gray); margin-bottom: 30px; }
        .result-details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
        .result-detail { background: var(--dark-card); border-radius: 12px; padding: 15px; text-align: center; }
        .result-detail .value { font-size: 1.5rem; font-weight: 700; }
        .result-detail .value.correct { color: #4cc9f0; }
        .result-detail .value.incorrect { color: var(--danger); }
        .result-detail .label { font-size: 0.8rem; color: var(--gray); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--dark-card); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-around; padding: 10px 0; padding-bottom: calc(10px + env(safe-area-inset-bottom)); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--gray); text-decoration: none; font-size: 0.75rem; cursor: pointer; padding: 8px 16px; border-radius: 12px; transition: all 0.2s ease; }
        .nav-item.active { color: var(--primary); background: rgba(67, 97, 238, 0.1); }
        .nav-item span:first-child { font-size: 1.3rem; }
        .settings-section { margin-bottom: 25px; }
        .settings-section h3 { font-size: 1rem; margin-bottom: 15px; color: var(--gray); }
        .setting-item { background: var(--dark-card); border-radius: 12px; padding: 15px 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .setting-item label { font-size: 0.95rem; }
        .toggle { width: 50px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 14px; position: relative; cursor: pointer; transition: all 0.3s ease; }
        .toggle.active { background: var(--primary); }
        .toggle::after { content: ''; position: absolute; width: 22px; height: 22px; background: white; border-radius: 50%; top: 3px; left: 3px; transition: all 0.3s ease; }
        .toggle.active::after { left: 25px; }
        .mode-select { display: flex; gap: 10px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 12px; border-radius: 10px; background: var(--dark-card); border: 2px solid transparent; color: var(--gray); cursor: pointer; font-weight: 600; transition: all 0.2s ease; }
        .mode-btn.active { border-color: var(--primary); color: var(--primary); }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>üìö OpoStudy</h1>
            <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
        </header>

        <div class="screen active" id="homeScreen">
            <div class="stats-grid">
                <div class="stat-card"><div class="number" id="totalAnswered">0</div><div class="label">Preguntas respondidas</div></div>
                <div class="stat-card"><div class="number" id="totalCorrect">0</div><div class="label">Respuestas correctas</div></div>
                <div class="stat-card"><div class="number" id="averageScore">0%</div><div class="label">Tasa de acierto</div></div>
                <div class="stat-card"><div class="number" id="streakDays">0</div><div class="label">Racha de d√≠as</div></div>
            </div>

            <div class="blocks-section">
                <h2>Selecciona un modo de test</h2>
                <div class="mode-select">
                    <button class="mode-btn" data-mode="full">üéØ Examen Completo (30)</button>
                    <button class="mode-btn active" data-mode="exam">üìù Examen (15)</button>
                    <button class="mode-btn" data-mode="practice">üìñ Pr√°ctica</button>
                </div>

                <h2>Selecciona un bloque tem√°tico</h2>
                <div class="block-card" data-block="1"><h3>üèõÔ∏è Bloque 1 <span class="badge">15 temas</span></h3><p>Organizaci√≥n del Estado y Administraci√≥n electr√≥nica</p></div>
                <div class="block-card" data-block="2"><h3>üíª Bloque 2 <span class="badge">15 temas</span></h3><p>Tecnolog√≠a b√°sica</p></div>
                <div class="block-card" data-block="3"><h3>‚öôÔ∏è Bloque 3 <span class="badge">15 temas</span></h3><p>Desarrollo de sistemas</p></div>
                <div class="block-card" data-block="4"><h3>üåê Bloque 4 <span class="badge">15 temas</span></h3><p>Sistemas y comunicaciones</p></div>

                <button class="btn btn-primary" id="startTest" disabled>Iniciar Test</button>
            </div>
        </div>

        <div class="screen" id="testScreen">
            <div class="question-counter">
                <span class="current" id="questionCounter">Pregunta 1 de 15</span>
                <span class="timer" id="timer">00:00</span>
            </div>
            <div class="question-card">
                <p class="question-text" id="questionText">Cargando pregunta...</p>
                <div class="options-list" id="optionsList"></div>
            </div>
            <button class="btn btn-primary" id="nextQuestion" disabled>Siguiente pregunta ‚Üí</button>
        </div>

        <div class="screen" id="resultsScreen">
            <div class="result-card">
                <div class="result-score" id="resultScore">0%</div>
                <div class="result-label" id="resultLabel">¬°Examen completado!</div>
                <div class="result-details">
                    <div class="result-detail"><div class="value correct" id="correctCount">0</div><div class="label">Correctas</div></div>
                    <div class="result-detail"><div class="value incorrect" id="incorrectCount">0</div><div class="label">Incorrectas</div></div>
                    <div class="result-detail"><div class="value" id="timeSpent">0:00</div><div class="label">Tiempo</div></div>
                </div>
                <div class="mode-select">
                    <button class="btn btn-secondary" id="retryBtn">üîÑ Repetir</button>
                    <button class="btn btn-primary" id="homeBtn">üè† Men√∫ principal</button>
                </div>
            </div>
        </div>

        <div class="screen" id="statsScreen">
            <h2 style="margin-bottom: 20px;">üìä Estad√≠sticas</h2>
            <div class="settings-section"><div class="setting-item"><label>Por bloque tem√°tico</label></div></div>
            <div class="stats-grid" style="grid-template-columns: 1fr;">
                <div class="stat-card"><div class="number" id="block1Stats">0%</div><div class="label">Bloque 1 - Organizaci√≥n del Estado</div></div>
                <div class="stat-card"><div class="number" id="block2Stats">0%</div><div class="label">Bloque 2 - Tecnolog√≠a b√°sica</div></div>
                <div class="stat-card"><div class="number" id="block3Stats">0%</div><div class="label">Bloque 3 - Desarrollo de sistemas</div></div>
                <div class="stat-card"><div class="number" id="block4Stats">0%</div><div class="label">Bloque 4 - Sistemas y comunicaciones</div></div>
            </div>
        </div>

        <div class="screen" id="settingsScreen">
            <h2 style="margin-bottom: 20px;">‚öôÔ∏è Configuraci√≥n</h2>
            <div class="settings-section">
                <h3>Test</h3>
                <div class="setting-item"><label>Preguntas por test</label><span id="questionsCountDisplay">15</span></div>
                <div class="setting-item"><label>Temporizador</label><div class="toggle active" id="timerToggle"></div></div>
            </div>
            <div class="settings-section">
                <h3>Sonido</h3>
                <div class="setting-item"><label>Efectos de sonido</label><div class="toggle active" id="soundToggle"></div></div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" data-screen="home"><span>üè†</span><span>Inicio</span></div>
            <div class="nav-item" data-screen="stats"><span>üìä</span><span>Stats</span></div>
            <div class="nav-item" data-screen="settings"><span>‚öôÔ∏è</span><span>Ajustes</span></div>
        </nav>
    </div>

    <script>
        const questionsDB = {
            1: [
                {question: "¬øCu√°l es el art√≠culo de la Constituci√≥n Espa√±ola que establece el derecho a la educaci√≥n?", options: ["Art√≠culo 14", "Art√≠culo 27", "Art√≠culo 35", "Art√≠culo 38"], correct: 1},
                {question: "¬øQu√© funciones tiene la Corona seg√∫n la Constituci√≥n Espa√±ola de 1978?", options: ["Legislar, ejecutar y juzgar", "Sancionar y promulgar leyes, proclamar referendos, arbitrar y moderar", "Nombrar al Presidente del Gobierno", "Convocar elecciones"], correct: 1},
                {question: "¬øCu√°ntos miembros tiene el Congreso de los Diputados?", options: ["250", "300", "350", "400"], correct: 2},
                {question: "¬øQu√© es el Defensor del Pueblo?", options: ["Un juez", "Un √≥rgano constitucional independiente", "Un miembro del Gobierno", "Un periodista"], correct: 1},
                {question: "¬øQu√© normativa regula la protecci√≥n de datos personales en Espa√±a?", options: ["Ley 34/2002", "RGPD y Ley Org√°nica 3/2018", "Ley 40/2015", "Ley 39/2015"], correct: 1},
                {question: "¬øQu√© es el Esquema Nacional de Interoperabilidad?", options: ["Un protocolo de internet", "Normas para el intercambio de informaci√≥n entre Administraciones", "Un sistema operativo", "Un lenguaje de programaci√≥n"], correct: 1},
                {question: "¬øQu√© establece la Ley 19/2013 de transparencia?", options: ["Derecho de acceso a informaci√≥n p√∫blica", "Protecci√≥n de datos", "Administraci√≥n electr√≥nica", "Contrataci√≥n p√∫blica"], correct: 0},
                {question: "¬øQu√© es una sede electr√≥nica?", options: ["Un edificio f√≠sico", "Un punto de acceso electr√≥nico a la Administraci√≥n", "Un servidor web", "Una aplicaci√≥n m√≥vil"], correct: 1},
                {question: "¬øQu√© principios rigen la Administraci√≥n P√∫blica seg√∫n la Constituci√≥n?", options: ["Jerarqu√≠a, imparcialidad y eficiencia", "Transparencia y participaci√≥n", "Eficacia y servicio al ciudadano", "Todas las anteriores"], correct: 3},
                {question: "¬øQu√© es el DNI electr√≥nico?", options: ["Un documento de identificaci√≥n f√≠sica", "Un documento con certificado digital incorporado", "Una aplicaci√≥n m√≥vil", "Una tarjeta de cr√©dito"], correct: 1},
                {question: "¬øCu√°ntos art√≠culos tiene la Constituci√≥n Espa√±ola de 1978?", options: ["165", "169", "175", "180"], correct: 1},
                {question: "¬øQu√© es el Tribunal Constitucional?", options: ["Un √≥rgano legislativo", "√ìrgano constitucional independiente", "Parte del Poder Judicial", "Un organismo administrativo"], correct: 1},
                {question: "¬øQu√© son las Cortes Generales?", options: ["El Gobierno", "El Parlamento bicameral", "El Tribunal Supremo", "La Corona"], correct: 1},
                {question: "¬øQu√© tipo de Estado establece la Constituci√≥n de 1978?", options: ["Estado unitario", "Estado federal", "Estado social y democr√°tico de derecho", "Estado confederal"], correct: 2},
                {question: "¬øQu√© es el Consejo de Transparencia y Buen Gobierno?", options: ["Un tribunal", "Un √≥rgano independiente", "Una agencia", "Un organismo consultivo"], correct: 1}
            ],
            2: [
                {question: "¬øQu√© componente es considerado el 'cerebro' del ordenador?", options: ["RAM", "CPU", "Disco duro", "Fuente de alimentaci√≥n"], correct: 1},
                {question: "¬øQu√© sistema operativo es de c√≥digo abierto?", options: ["Windows", "macOS", "Linux", "iOS"], correct: 2},
                {question: "¬øQu√© tipo de base de datos utiliza SQL?", options: ["NoSQL", "Relacional", "Jer√°rquica", "De red"], correct: 1},
                {question: "¬øQu√© dispositivo se utiliza para conectar una red local a internet?", options: ["Switch", "Router", "Hub", "Bridge"], correct: 1},
                {question: "¬øQu√© significa RAM?", options: ["Read Access Memory", "Random Access Memory", "Ready Available Memory", "Rapid Access Module"], correct: 1},
                {question: "¬øQu√© es un perif√©rico?", options: ["Un componente interno", "Un dispositivo externo", "Un programa", "Una red"], correct: 1},
                {question: "¬øQu√© sistema de archivos usa Windows principalmente?", options: ["ext4", "NTFS", "APFS", "FAT32"], correct: 1},
                {question: "¬øQu√© es un algoritmo?", options: ["Un programa", "Un conjunto de pasos ordenados para resolver un problema", "Un lenguaje de programaci√≥n", "Un tipo de datos"], correct: 1},
                {question: "¬øQu√© tipo de almacenamiento es el SSD?", options: ["Mec√°nico", "√ìptico", "De estado s√≥lido", "Magn√©tico"], correct: 2},
                {question: "¬øQu√© significa GUI?", options: ["Graphical User Interface", "General User Interface", "Global User Integration", "Graphic Unified Input"], correct: 0},
                {question: "¬øQu√© es la memoria ROM?", options: ["Memoria de solo lectura", "Memoria de lectura y escritura", "Memoria vol√°til", "Memoria cach√©"], correct: 0},
                {question: "¬øQu√© significa CPU?", options: ["Central Processing Unit", "Computer Personal Unit", "Central Program Utility", "Core Processing Unit"], correct: 0},
                {question: "¬øQu√© es un puerto USB?", options: ["Un protocolo", "Una interfaz de conexi√≥n", "Un programa", "Un tipo de archivo"], correct: 1},
                {question: "¬øQu√© significa IP en redes?", options: ["Internet Protocol", "Internal Protocol", "Information Protocol", "Interconnection Protocol"], correct: 0},
                {question: "¬øQu√© es un sistema operativo?", options: ["Un hardware", "Software que gestiona el sistema", "Una red", "Un protocolo"], correct: 1}
            ],
            3: [
                {question: "¬øQu√© es una entidad en un modelo de datos?", options: ["Un atributo", "Un objeto del mundo real con existencia propia", "Una relaci√≥n", "Una tabla"], correct: 1},
                {question: "¬øQu√© es la normalizaci√≥n de bases de datos?", options: ["Un tipo de backup", "Proceso de organizar datos para evitar redundancia", "Un lenguaje de programaci√≥n", "Un protocolo de red"], correct: 1},
                {question: "¬øQu√© significa SQL?", options: ["Structured Question Language", "Structured Query Language", "Simple Query Logic", "Standard Query Link"], correct: 1},
                {question: "¬øQu√© es UML?", options: ["Un lenguaje de programaci√≥n", "Lenguaje de modelado unificado", "Un sistema de archivos", "Un protocolo"], correct: 1},
                {question: "¬øQu√© es la herencia en programaci√≥n orientada a objetos?", options: ["Un tipo de variable", "Mecanismo por el cual una clase hereda propiedades de otra", "Un bucle", "Una funci√≥n"], correct: 1},
                {question: "¬øQu√© es HTML?", options: ["Un lenguaje de programaci√≥n", "Lenguaje de marcado de hipertexto", "Un sistema de bases de datos", "Un protocolo"], correct: 1},
                {question: "¬øQu√© es un disparador (trigger)?", options: ["Un tipo de dato", "Un procedimiento que se ejecuta autom√°ticamente", "Un usuario", "Un servidor"], correct: 1},
                {question: "¬øQu√© es Java EE?", options: ["Un hardware", "Una plataforma de desarrollo empresarial", "Un sistema operativo", "Una red"], correct: 1},
                {question: "¬øQu√© significa API?", options: ["Application Programming Interface", "Automatic Program Integration", "Advanced Programming Item", "Application Process Integration"], correct: 0},
                {question: "¬øQu√© es un patr√≥n de dise√±o?", options: ["Un error de programaci√≥n", "Una soluci√≥n reutilizable a problemas comunes", "Un tipo de dato", "Un lenguaje"], correct: 1},
                {question: "¬øQu√© es XML?", options: ["Un lenguaje de programaci√≥n", "Lenguaje de marcado extensible", "Una base de datos", "Un protocolo"], correct: 1},
                {question: "¬øQu√© es un procedimiento almacenado?", options: ["Una funci√≥n del sistema", "C√≥digo SQL guardado en la base de datos", "Un trigger", "Una tabla virtual"], correct: 1},
                {question: "¬øQu√© significa POO?", options: ["Programaci√≥n Orientada a Objetos", "Protocolo de Objetos", "Proceso de Objetos", "Programaci√≥n de Objetos"], correct: 0},
                {question: "¬øQu√© es JSON?", options: ["Un lenguaje de programaci√≥n", "Un formato de intercambio de datos", "Una base de datos", "Un protocolo"], correct: 1},
                {question: "¬øQu√© es un IDE?", options: ["Un hardware", "Entorno de desarrollo integrado", "Un tipo de red", "Un sistema operativo"], correct: 1}
            ],
            4: [
                {question: "¬øQu√© protocolo usa HTTP?", options: ["TCP/IP", "UDP", "FTP", "SMTP"], correct: 0},
                {question: "¬øQu√© es una VPN?", options: ["Una red social", "Red privada virtual", "Un tipo de virus", "Un protocolo de correo"], correct: 1},
                {question: "¬øCu√°ntas capas tiene el modelo OSI?", options: ["5", "6", "7", "8"], correct: 2},
                {question: "¬øQu√© es un firewall?", options: ["Un tipo de software", "Sistema de protecci√≥n perimetral", "Un hardware de red", "Un protocolo"], correct: 1},
                {question: "¬øQu√© significa TCP?", options: ["Transfer Control Protocol", "Transmission Control Protocol", "Transport Connection Process", "Total Control Protocol"], correct: 1},
                {question: "¬øQu√© es un backup?", options: ["Un virus", "Copia de seguridad", "Un protocolo", "Un firewall"], correct: 1},
                {question: "¬øQu√© es la virtualizaci√≥n?", options: ["Crear sistemas operativos", "Crear versiones virtuales de recursos", "Un lenguaje", "Un hardware"], correct: 1},
                {question: "¬øQu√© protocolo usa el correo electr√≥nico?", options: ["HTTP", "SMTP/POP3/IMAP", "FTP", "SSH"], correct: 1},
                {question: "¬øQu√© es un certificado digital?", options: ["Un documento f√≠sico", "Documento electr√≥nico que verifica identidad", "Una firma manuscrita", "Una contrase√±a"], correct: 1},
                {question: "¬øQu√© es un ataque de phishing?", options: ["Un virus inform√°tico", "Suplantaci√≥n de identidad para obtener datos", "Un tipo de backup", "Un protocolo"], correct: 1},
                {question: "¬øQu√© es el modelo TCP/IP?", options: ["Un modelo de 7 capas", "Un protocolo de correo", "Modelo de protocolos de red", "Un lenguaje de programaci√≥n"], correct: 2},
                {question: "¬øQu√© significa DNS?", options: ["Digital Network System", "Domain Name System", "Data Network Service", "Dynamic Name System"], correct: 1},
                {question: "¬øQu√© es un servidor web?", options: ["Un tipo de ordenador", "Software que sirve p√°ginas web", "Un protocolo", "Un lenguaje"], correct: 1},
                {question: "¬øQu√© significa HTTPS?", options: ["Hyper Text Transfer Protocol Secure", "Hyper Text Transfer Protocol", "High Transfer Text Protocol", "Hyper Text Transmission Protocol"], correct: 0},
                {question: "¬øQu√© es una IP din√°mica?", options: ["Una IP fija", "Una IP que cambia autom√°ticamente", "Una IP segura", "Una IP privada"], correct: 1}
            ]
        };

        let state = {
            selectedBlock: null,
            testMode: 'exam',
            questionsCount: 15,
            currentQuestions: [],
            currentIndex: 0,
            selectedAnswer: null,
            answers: [],
            timerEnabled: true,
            soundEnabled: true,
            timer: null,
            timeElapsed: 0,
            stats: { totalAnswered: 0, totalCorrect: 0, blockStats: { 1: [], 2: [], 3: [], 4: [] } }
        };

        const screens = {
            home: document.getElementById('homeScreen'),
            test: document.getElementById('testScreen'),
            results: document.getElementById('resultsScreen'),
            stats: document.getElementById('statsScreen'),
            settings: document.getElementById('settingsScreen')
        };

        function loadStats() {
            const saved = localStorage.getItem('opoStudyStats');
            if (saved) {
                state.stats = JSON.parse(saved);
                updateHomeStats();
            }
        }

        function saveStats() {
            localStorage.setItem('opoStudyStats', JSON.stringify(state.stats));
        }

        function updateHomeStats() {
            document.getElementById('totalAnswered').textContent = state.stats.totalAnswered;
            document.getElementById('totalCorrect').textContent = state.stats.totalCorrect;
            const average = state.stats.totalAnswered > 0 ? Math.round((state.stats.totalCorrect / state.stats.totalAnswered) * 100) : 0;
            document.getElementById('averageScore').textContent = average + '%';
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName].classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector('.nav-item[data-screen="' + screenName + '"]').classList.add('active');
            if (screenName === 'stats') updateStatsScreen();
        }

        function selectBlock(blockNum) {
            state.selectedBlock = blockNum;
            document.querySelectorAll('.block-card').forEach(card => {
           card.classList.toggle('selected', parseInt(card.dataset.block, 10) === blockNum);
  });
  document.getElementById('startTest').disabled = false;
}    

        function selectMode(mode) {
            state.testMode = mode;
            if (mode === 'full') {
                state.questionsCount = 30;
                state.selectedBlock = null;
                document.querySelectorAll('.block-card').forEach(card => card.classList.remove('selected'));
                document.getElementById('startTest').disabled = false;
            } else if (mode === 'exam') {
                state.questionsCount = 15;
            } else {
                state.questionsCount = 15;
            }
            document.querySelectorAll('.mode-btn').forEach(btn => {
              btn.classList.toggle('active', btn.dataset.mode === mode);
  });

  document.getElementById('questionsCountDisplay').textContent = state.questionsCount;

  // ‚úÖ clave: habilitar/deshabilitar start seg√∫n modo
  document.getElementById('startTest').disabled = (mode !== 'full' && !state.selectedBlock);
} 

    function generateTest() {
  document.getElementById('progressFill').style.width = '0%';
  document.getElementById('timer').textContent = '00:00';

  let blockQuestions;
  if (state.testMode === 'full') {
    blockQuestions = [...questionsDB[1], ...questionsDB[2], ...questionsDB[3], ...questionsDB[4]];
  } else {
    blockQuestions = questionsDB[state.selectedBlock];
  }

  const shuffled = [...blockQuestions].sort(() => Math.random() - 0.5);
  state.currentQuestions = shuffled.slice(0, state.questionsCount);
  state.currentIndex = 0;
  state.answers = [];
  state.timeElapsed = 0;

  showQuestion();
  startTimer();
  showScreen('test');
}   

        function showQuestion() {
            const question = state.currentQuestions[state.currentIndex];
            document.getElementById('questionCounter').textContent = 'Pregunta ' + (state.currentIndex + 1) + ' de ' + state.currentQuestions.length;
            document.getElementById('questionText').textContent = question.question;
            
            let questionOptions = question.options.map((opt, i) => {
                return '<div class="option" data-index="' + i + '"><span class="letter">' + String.fromCharCode(65 + i) + '</span><span>' + opt + '</span></div>';
            });
            document.getElementById('optionsList').innerHTML = questionOptions.join('');
            
            state.selectedAnswer = null;
            document.getElementById('nextQuestion').disabled = true;
            
            document.querySelectorAll('.option').forEach(opt => {
                opt.addEventListener('click', () => selectAnswer(parseInt(opt.dataset.index)));
            });
        }

        function selectAnswer(index) {
            if (state.testMode === 'exam' && state.selectedAnswer !== null) return;
            state.selectedAnswer = index;
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                if (i === index) opt.classList.add('selected');
            });
            if (state.testMode === 'practice') {
                const question = state.currentQuestions[state.currentIndex];
                document.querySelectorAll('.option').forEach((opt, i) => {
                    if (i === question.correct) opt.classList.add('correct');
                    else if (i === index && i !== question.correct) opt.classList.add('incorrect');
                });
            }
            document.getElementById('nextQuestion').disabled = false;
        }

        function nextQuestion() {
            const question = state.currentQuestions[state.currentIndex];
            const isCorrect = state.selectedAnswer === question.correct;
            
            state.answers.push({ question: state.currentIndex, selected: state.selectedAnswer, correct: question.correct, isCorrect: isCorrect });
            
            state.stats.totalAnswered++;
            if (isCorrect) state.stats.totalCorrect++;
            if (state.selectedBlock) state.stats.blockStats[state.selectedBlock].push(isCorrect ? 1 : 0);
            saveStats();

            state.currentIndex++;
            if (state.currentIndex >= state.currentQuestions.length) {
                finishTest();
            } else {
                showQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = (state.currentIndex / state.currentQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function startTimer() {
            if (state.timer) clearInterval(state.timer);
            if (!state.timerEnabled) return;
            state.timer = setInterval(() => {
                state.timeElapsed++;
                const minutes = Math.floor(state.timeElapsed / 60);
                const seconds = state.timeElapsed % 60;
                document.getElementById('timer').textContent = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            }, 1000);
        }

        function stopTimer() {
            if (state.timer) clearInterval(state.timer);
        }

        function finishTest() {
            stopTimer();
            const correct = state.answers.filter(a => a.isCorrect).length;
            const total = state.answers.length;
            const percentage = Math.round((correct / total) * 100);
            
            document.getElementById('resultScore').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = total - correct;
            
            const minutes = Math.floor(state.timeElapsed / 60);
            const seconds = state.timeElapsed % 60;
            document.getElementById('timeSpent').textContent = minutes + ':' + seconds.toString().padStart(2, '0');
            
            let label = '¬°Examen completado!';
            if (percentage >= 90) label = '¬°Excelente! üéâ';
            else if (percentage >= 70) label = '¬°Muy bien! üëç';
            else if (percentage >= 50) label = '¬°Puedes mejorar! üí™';
            else label = '¬°Sigue practicando! üìö';
            
            document.getElementById('resultLabel').textContent = label;
            document.getElementById('progressFill').style.width = '100%';
            updateHomeStats();
            showScreen('results');
        }

        function updateStatsScreen() {
            [1, 2, 3, 4].forEach(block => {
                const stats = state.stats.blockStats[block];
                const percentage = stats.length > 0 ? Math.round((stats.filter(s => s === 1).length / stats.length) * 100) : 0;
                document.getElementById('block' + block + 'Stats').textContent = percentage + '%';
            });
        }

        document.querySelectorAll('.block-card').forEach(card => {
            card.addEventListener('click', () => { state.selectedBlock = parseInt(card.dataset.block); selectBlock(card.dataset.block); });
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => selectMode(btn.dataset.mode));
        });

        document.getElementById('startTest').addEventListener('click', generateTest);
        document.getElementById('nextQuestion').addEventListener('click', nextQuestion);
        
        document.getElementById('retryBtn').addEventListener('click', () => {
            state.currentIndex = 0;
            state.answers = [];
            state.timeElapsed = 0;
            generateTest();
        });
        
        document.getElementById('homeBtn').addEventListener('click', () => {
            document.getElementById('progressFill').style.width = '0%';
            showScreen('home');
        });

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => showScreen(item.dataset.screen));
        });

        document.getElementById('timerToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            state.timerEnabled = this.classList.contains('active');
        });

        document.getElementById('soundToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            state.soundEnabled = this.classList.contains('active');
        });

        loadStats();
    </script>
</body>
</html>
